<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCOtWnclREDvlceNlpUFdUsjEy--zCCWww",
    authDomain: "gate-fee-system.firebaseapp.com",
    databaseURL: "https://gate-fee-system-default-rtdb.firebaseio.com",
    projectId: "gate-fee-system",
    storageBucket: "gate-fee-system.appspot.com",
    messagingSenderId: "35497617973",
    appId: "1:35497617973:web:ffb46ac4d5ea50206fdf7c"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const currentUser = localStorage.getItem("loggedInUser") || "";
  const users = JSON.parse(localStorage.getItem("gateSystemUsers") || "{}");

  if (currentUser !== "admin") {
    alert("Access denied. Admin only.");
    window.location.href = "index.html";
  }

  function saveLocalUser(username, userData) {
    const users = JSON.parse(localStorage.getItem("gateSystemUsers") || "{}");
    users[username] = userData;
    localStorage.setItem("gateSystemUsers", JSON.stringify(users));
  }

  document.getElementById("addUserForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const email = document.getElementById("email").value.trim();

    if (users[username]) {
      document.getElementById("statusMsg").style.color = "red";
      document.getElementById("statusMsg").textContent = "User already exists.";
      return;
    }

    const userData = { password, phone, contact: email };

    // Save to Firebase
    db.ref("users/" + username).set(userData);

    // Save to localStorage
    saveLocalUser(username, userData);

    document.getElementById("statusMsg").style.color = "green";
    document.getElementById("statusMsg").textContent = `User "${username}" added successfully.`;
    e.target.reset();
  });
</script>
